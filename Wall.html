<!doctype html>
<html>
<audio id = 'pingMp3' src="Resources/ping.mp3"></audio>
<div style='background-color:#333333;width:640px;'>
    <canvas id="gameCanvas" width="640" height = '480'></canvas>
</div>
<script>
    var ctx = gameCanvas.getContext("2d");
    var x=280, y=400, speedX=0, speedY=-8, batX=280, score=0;
    drawBricks();
    function drawBricks(){
        let randomNumber = Math.floor(Math.random() * 10) + 1;
        for(a=0;a<randomNumber; a++){
            for(b=0;b<9;b++){
                ctx.fillStyle='#00ff7b'+(40+a*40).toString(16);
                ctx.fillRect(b*80,100+a*20,79,19);
            }
        }
    }
    var gameTimer=setInterval(mainLoop,25);
    function mainLoop() {
        ctx.clearRect(x,y,7,7);
        x=x+speedX;
        y=y+speedY;
        checkForHits();
        ctx.fillStyle='#ffffff';
        ctx.fillRect(x,y,7,7);
        if((x>620)||(x<0))speedX=-speedX;
        if(y<28)speedY=8;
        if(y>480){gameOver();}
        ctx.clearRect(0,460,640,20);
        ctx.fillStyle='#cccccc';
        ctx.fillRect(batX-60,460,120,20);
    }
    function checkForHits(){
        var col=ctx.getImageData(x,y,1,1).data;
        if((y>460)&&(Math.abs(batX-x)<60)){
            speedY=-8;
            speedX=Math.round(0.15*(x-batX));
        }else if(col[3]!=0){
            pingMp3.currentTime=0;
            pingMp3.play();
            var x0=80*Math.floor(x/80);
            var y0=20*Math.floor(y/20);
            ctx.clearRect(x0,y0,79,19);
            speedY=-speedY;
            score++;
            ctx.fillRect(0,0,640,20);
            ctx.fillStyle='black';
            ctx.font = '20px Arial';
            ctx.fillText('Score: '+score,2,16);
        }
    }
    document.onmousemove = function(){batX=event.clientX;}
    function gameOver(){
        clearInterval(gameTimer);
        ctx.font = '80px Arial';
        ctx.fillText('Game Over!',100,250);
    }
</script>
</html>